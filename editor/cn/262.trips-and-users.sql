-- è¡¨ï¼šTrips
--  
--  
--  
-- +-------------+----------+
-- | Column Name | Type     |
-- +-------------+----------+
-- | Id          | int      |
-- | Client_Id   | int      |
-- | Driver_Id   | int      |
-- | City_Id     | int      |
-- | Status      | enum     |
-- | Request_at  | date     |     
-- +-------------+----------+
-- Id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚
-- è¿™å¼ è¡¨ä¸­å­˜æ‰€æœ‰å‡ºç§Ÿè½¦çš„è¡Œç¨‹ä¿¡æ¯ã€‚æ¯æ®µè¡Œç¨‹æœ‰å”¯ä¸€ Id ï¼Œå…¶ä¸­ Client_Id å’Œ Driver_Id æ˜¯ Users è¡¨ä¸­ Users_Id çš„å¤–é”®ã€‚
-- Status æ˜¯ä¸€ä¸ªè¡¨ç¤ºè¡Œç¨‹çŠ¶æ€çš„æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º(â€˜completedâ€™, â€˜cancelled_by_driverâ€™, â€˜cancelled_by_
-- clientâ€™) ã€‚
--  
-- 
--  
-- 
--  
--  
--  è¡¨ï¼šUsers 
--  
--  
-- 
--  
-- +-------------+----------+
-- | Column Name | Type     |
-- +-------------+----------+
-- | Users_Id    | int      |
-- | Banned      | enum     |
-- | Role        | enum     |
-- +-------------+----------+
-- Users_Id æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ã€‚
-- è¿™å¼ è¡¨ä¸­å­˜æ‰€æœ‰ç”¨æˆ·ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ Users_Id ï¼ŒRole æ˜¯ä¸€ä¸ªè¡¨ç¤ºç”¨æˆ·èº«ä»½çš„æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º (â€˜clientâ€™, â€˜driverâ€™,
--  â€˜partnerâ€™) ã€‚
-- Banned æ˜¯ä¸€ä¸ªè¡¨ç¤ºç”¨æˆ·æ˜¯å¦è¢«ç¦æ­¢çš„æšä¸¾ç±»å‹ï¼Œæšä¸¾æˆå‘˜ä¸º (â€˜Yesâ€™, â€˜Noâ€™) ã€‚
--  
-- 
--  
-- 
--  å†™ä¸€æ®µ SQL è¯­å¥æŸ¥å‡º "2013-10-01" è‡³ "2013-10-03" æœŸé—´éç¦æ­¢ç”¨æˆ·ï¼ˆä¹˜å®¢å’Œå¸æœºéƒ½å¿…é¡»æœªè¢«ç¦æ­¢ï¼‰çš„å–æ¶ˆç‡ã€‚éç¦æ­¢ç”¨æˆ·å³ Ban
-- ned ä¸º No çš„ç”¨æˆ·ï¼Œç¦æ­¢ç”¨æˆ·å³ Banned ä¸º Yes çš„ç”¨æˆ·ã€‚ 
-- 
--  å–æ¶ˆç‡ çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š(è¢«å¸æœºæˆ–ä¹˜å®¢å–æ¶ˆçš„éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ•°é‡) / (éç¦æ­¢ç”¨æˆ·ç”Ÿæˆçš„è®¢å•æ€»æ•°)ã€‚ 
-- 
--  è¿”å›ç»“æœè¡¨ä¸­çš„æ•°æ®å¯ä»¥æŒ‰ä»»æ„é¡ºåºç»„ç»‡ã€‚å…¶ä¸­å–æ¶ˆç‡ Cancellation Rate éœ€è¦å››èˆäº”å…¥ä¿ç•™ ä¸¤ä½å°æ•° ã€‚ 
-- 
--  
-- 
--  æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š 
-- 
--  
-- Trips è¡¨ï¼š
-- +----+-----------+-----------+---------+---------------------+------------+
-- | Id | Client_Id | Driver_Id | City_Id | Status              | Request_at |
-- +----+-----------+-----------+---------+---------------------+------------+
-- | 1  | 1         | 10        | 1       | completed           | 2013-10-01 |
-- | 2  | 2         | 11        | 1       | cancelled_by_driver | 2013-10-01 |
-- | 3  | 3         | 12        | 6       | completed           | 2013-10-01 |
-- | 4  | 4         | 13        | 6       | cancelled_by_client | 2013-10-01 |
-- | 5  | 1         | 10        | 1       | completed           | 2013-10-02 |
-- | 6  | 2         | 11        | 6       | completed           | 2013-10-02 |
-- | 7  | 3         | 12        | 6       | completed           | 2013-10-02 |
-- | 8  | 2         | 12        | 12      | completed           | 2013-10-03 |
-- | 9  | 3         | 10        | 12      | completed           | 2013-10-03 |
-- | 10 | 4         | 13        | 12      | cancelled_by_driver | 2013-10-03 |
-- +----+-----------+-----------+---------+---------------------+------------+
-- 
-- Users è¡¨ï¼š
-- +----------+--------+--------+
-- | Users_Id | Banned | Role   |
-- +----------+--------+--------+
-- | 1        | No     | client |
-- | 2        | Yes    | client |
-- | 3        | No     | client |
-- | 4        | No     | client |
-- | 10       | No     | driver |
-- | 11       | No     | driver |
-- | 12       | No     | driver |
-- | 13       | No     | driver |
-- +----------+--------+--------+
-- 
-- Result è¡¨ï¼š
-- +------------+-------------------+
-- | Day        | Cancellation Rate |
-- +------------+-------------------+
-- | 2013-10-01 | 0.33              |
-- | 2013-10-02 | 0.00              |
-- | 2013-10-03 | 0.50              |
-- +------------+-------------------+
-- 
-- 2013-10-01ï¼š
--   - å…±æœ‰ 4 æ¡è¯·æ±‚ï¼Œå…¶ä¸­ 2 æ¡å–æ¶ˆã€‚
--   - ç„¶è€Œï¼ŒId=2 çš„è¯·æ±‚æ˜¯ç”±ç¦æ­¢ç”¨æˆ·ï¼ˆUser_Id=2ï¼‰å‘å‡ºçš„ï¼Œæ‰€ä»¥è®¡ç®—æ—¶åº”å½“å¿½ç•¥å®ƒã€‚
--   - å› æ­¤ï¼Œæ€»å…±æœ‰ 3 æ¡éç¦æ­¢è¯·æ±‚å‚ä¸è®¡ç®—ï¼Œå…¶ä¸­ 1 æ¡å–æ¶ˆã€‚
--   - å–æ¶ˆç‡ä¸º (1 / 3) = 0.33
-- 2013-10-02ï¼š
--   - å…±æœ‰ 3 æ¡è¯·æ±‚ï¼Œå…¶ä¸­ 0 æ¡å–æ¶ˆã€‚
--   - ç„¶è€Œï¼ŒId=6 çš„è¯·æ±‚æ˜¯ç”±ç¦æ­¢ç”¨æˆ·å‘å‡ºçš„ï¼Œæ‰€ä»¥è®¡ç®—æ—¶åº”å½“å¿½ç•¥å®ƒã€‚
--   - å› æ­¤ï¼Œæ€»å…±æœ‰ 2 æ¡éç¦æ­¢è¯·æ±‚å‚ä¸è®¡ç®—ï¼Œå…¶ä¸­ 0 æ¡å–æ¶ˆã€‚
--   - å–æ¶ˆç‡ä¸º (0 / 2) = 0.00
-- 2013-10-03ï¼š
--   - å…±æœ‰ 3 æ¡è¯·æ±‚ï¼Œå…¶ä¸­ 1 æ¡å–æ¶ˆã€‚
--   - ç„¶è€Œï¼ŒId=8 çš„è¯·æ±‚æ˜¯ç”±ç¦æ­¢ç”¨æˆ·å‘å‡ºçš„ï¼Œæ‰€ä»¥è®¡ç®—æ—¶åº”å½“å¿½ç•¥å®ƒã€‚
--   - å› æ­¤ï¼Œæ€»å…±æœ‰ 2 æ¡éç¦æ­¢è¯·æ±‚å‚ä¸è®¡ç®—ï¼Œå…¶ä¸­ 1 æ¡å–æ¶ˆã€‚
--   - å–æ¶ˆç‡ä¸º (1 / 2) = 0.50
--  
--  
--  
--  ğŸ‘ 184 ğŸ‘ 0

# test case æœ‰é—®é¢˜ï¼Œæ­£è§£åº”è¯¥æ˜¯è¿™æ ·
SELECT
    T.Request_at AS 'Day',
    ROUND(SUM(
        IF(T.Status='completed', 0, 1)
    ) / COUNT(*), 2) AS 'Cancellation Rate'
FROM
    Trips AS T
    JOIN Users AS U1 ON (T.Client_Id = U1.Users_Id AND U1.Banned ='No')
    JOIN Users AS U2 ON (T.Driver_Id = U2.Users_Id AND U2.Banned ='No')
WHERE
    T.Request_at BETWEEN '2013-10-01' AND '2013-10-03'
GROUP BY
    T.Request_at
;